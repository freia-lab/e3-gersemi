
record (bi, "CstatV-Ctrl:s7-status") {
  field (DTYP, "S7plc stat")
  field (INP,  "@PLC:GERSEMI")
  field (SCAN, "I/O Intr")
  field (ZNAM, "disconnected")
  field (ONAM, "connected")
  field (ZSV,  "MAJOR")
  field (FLNK, "CstatV-Ctrl:s7-status-counter")
}

#record (bo, "CstatV-Ctrl:opMode:cmdLocal") {
#  field (DTYP, "S7plc")
#  field (OUT, "@PLC:GERSEMI/1 T=BYTE B=0")
#  field (ZNAM, "Iddle")
#  field (ONAM, "CmdLocal")
#  field (PINI, "NO")
#  field (HIGH, "0.5")
#}

record (bi, "CstatV-Ctrl:opMode:sLocal") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/0 T=BYTE B=0")
  field (PINI, "YES")
  field (PHAS, "0")
  field (ONAM,  "Local")
  field (ZNAM,  "Remote")
  field (SCAN, "I/O Intr")
}

record (bi, "CstatV-Ctrl:CV5203:cOpen") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/1 T=BYTE B=0")
  field (PINI, "YES")
  field (PHAS, "0")
  field (ONAM,  "cmdOpen")
  field (ZNAM,  "Iddle")
  field (FLNK, "CstatV-Ctrl:CV5203:OCcmd")
  field (SCAN, "I/O Intr")
}

record (bi, "CstatV-Ctrl:CV5203:cClose") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/1 T=BYTE B=1")
  field (PINI, "YES")
  field (PHAS, "0")
  field (ONAM,  "cmdClose")
  field (ZNAM,  "Iddle")
  field (FLNK, "CstatV-Ctrl:CV5203:OCcmd")
  field (SCAN, "I/O Intr")
}

record (calc, "CstatV-Ctrl:CV5203:OCcmd") {
       field (INPA, "CstatV-Ctrl:CV5203:cClose")
       field (INPB, "CstatV-Ctrl:CV5203:cOpen")
       field (INPC, "Cryo-Dwr:Dwr:StCV5203_Slctd CA")
       field (CALC, "(!C)&&B||(C&&A)")
       field (FLNK, "Cryo-Dwr:CV-5203:OpenClsCmd.PROC CA")
}

record (calcout, "CstatV-Ctrl:CV5203:OCcmd-ackO") {
       field (INPA, "Cryo-Dwr:CV-5203:OpenClsCmd")
       field (INPB, "CstatV-Ctrl:CV5203:cOpen")
       field (CALC, "A&&B")
       field (SDIS, "Cryo-Dwr:CV-5203:OpenClsCmd.OMSL")
       field (DISV, "0")
       field (OOPT, "Transition To Non-zero")
       field (FLNK, "CstatV-Ctrl:CV5203:OCcmd-ackC")
       field (PINI, "YES")
       field (OUT, "CstatV-Ctrl:CV5203:ackO-x.PROC")
}

record (calcout, "CstatV-Ctrl:CV5203:OCcmd-ackC") {
       field (INPA, "Cryo-Dwr:CV-5203:OpenClsCmd")
       field (INPB, "CstatV-Ctrl:CV5203:cClose")
       field (CALC, "A&&B")
       field (SDIS, "Cryo-Dwr:CV-5203:OpenClsCmd.OMSL")
       field (DISV, "0")
       field (OOPT, "Transition To Non-zero")
       field (PINI, "YES")
       field (OUT, "CstatV-Ctrl:CV5203:ackC-x.PROC")
}

# Help records to produce the pulsed bo

record (bo, "ackO-x") {
       field (DOL, "1")
       field (OMSL, "closed_loop")
       field (OUT, "CstatV-Ctrl:CV5203:ackOpen.VAL PP NMS")
}
record (bo, "ackC-x") {
       field (DOL, "1")
       field (OMSL, "closed_loop")
       field (OUT, "CstatV-Ctrl:CV5203:ackClose.VAL PP NMS")
}

# Acknowledge bits for the open/close CV5203 commands

record (bo, "CstatV-Ctrl:CV5203:ackOpen") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/1 T=BYTE B=0")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdOpenAck")
  field (PINI, "NO")
  field (HIGH, "0.5")
}
record (bo, "CstatV-Ctrl:CV5203:ackClose") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/1 T=BYTE B=1")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdCloseAck")
  field (PINI, "NO")
  field (HIGH, "0.5")
}


record (longin, "CstatV-Ctrl:HeartBeat:sHBcounter") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/2 T=INT16")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}

record(mbbi, "CstatV-RHtr:VBox:opMode") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:GERSEMI/4 T=INT16")
  field(NOBT, "16")
  field(ZRVL, "0")
  field(ZRST, "Nothing")
  field(ONVL, "1")
  field(ONST, "To Kaeser")
  field(TWVL, "2")
  field(TWST, "To gas bag")
  field(THVL, "3")
  field(THST, "Switching to Kaeser")
  field(FRVL, "4")
  field(FRST, "Switching to gas bag")
  field(SCAN, "I/O Intr")
}

record(mbbi, "CstatV-RHtr:Cstat4K:opMode") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:GERSEMI/6 T=INT16")
  field(NOBT, "16")
  field(ZRVL, "0")
  field(ZRST, "Nothing")
  field(ONVL, "1")
  field(ONST, "To Kaeser")
  field(TWVL, "2")
  field(TWST, "To gas bag")
  field(THVL, "3")
  field(THST, "Switching to Kaeser")
  field(FRVL, "4")
  field(FRST, "Switching to gas bag")
  field(SCAN, "I/O Intr")
}

record(mbbi, "CstatV-RHtr:Mag4K:opMode") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:GERSEMI/8 T=INT16")
  field(NOBT, "16")
  field(ZRVL, "0")
  field(ZRST, "Nothing")
  field(ONVL, "1")
  field(ONST, "To Kaeser")
  field(TWVL, "2")
  field(TWST, "To gas bag")
  field(THVL, "3")
  field(THST, "Switching to Kaeser")
  field(FRVL, "4")
  field(FRST, "Switching to gas bag")
  field(SCAN, "I/O Intr")
}

record (longin, "CstatV-Ctrl:Alarms:sAlarmB1") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9438 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB2") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9439 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB3") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9440 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB4") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9441 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB5") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9442 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}

record (longin, "CstatV-Ctrl:Alarms:sAlarmB6") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9443 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB7") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9444 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB8") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9445 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB9") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9446 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB10") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9447 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}


record (bo, "CstatV-Ctrl:opMode:cmdSetParam") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=0")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetParam")
  field (PINI, "NO")
  field (HIGH, "0.5")
}

record (bo, "CstatV-Ctrl:opMode:cmdSetAck") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=1")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetAck")
  field (PINI, "NO")
  field (HIGH, "0.5")
}


#record (bo, "CstatV-Ctrl:opMode:cmdRemote") {
#  field (DTYP, "S7plc")
#  field (OUT, "@PLC:GERSEMI/1 T=BYTE B=1")
#  field (ZNAM, "Iddle")
#  field (ONAM, "CmdRemote")
#  field (PINI, "NO")
#  field (HIGH, "0.5")
#}

record (calc, "CstatV-Ctrl:s7-status-counter")
{
   field (INPA, "CstatV-Ctrl:s7-status-counter")
   field (CALC, "A+1")
   field (FLNK, "CstatV-Ctrl:s7-disconnect-counter")
}

record (calc, "CstatV-Ctrl:s7-disconnect-counter")
{
   field (INPA, "CstatV-Ctrl:s7-status")
   field (INPB, "CstatV-Ctrl:s7-disconnect-counter.LA")
   field (INPC, "CstatV-Ctrl:s7-disconnect-counter")
   field (CALC, "(A=0&&B=1)?C+1:C")
}

# Commands specific for given sequences

record(bo, "CstatV-Ctrl:SQ9:cmdStopLiq") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:GERSEMI/4549 T=BYTE B=1")
  field(HIGH, "0.5")
  field(ZNAM, "Iddle")
  field(ONAM, "CmdStopLiq")
  field(SDIS, "CstatV-Ctrl:opMode:sLocal")
}

record(bo, "CstatV-Ctrl:SQ9:cmdStopDwr") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:GERSEMI/4549 T=BYTE B=2")
  field(HIGH, "0.5")
  field(ZNAM, "Iddle")
  field(ONAM, "CmdStopLiq")
  field(SDIS, "CstatV-Ctrl:opMode:sLocal")
}

record(bo, "CstatV-Ctrl:Archiving:On") {
  field(DESC, "Turn CstatV archiving on or off")
  field(ZNAM, "Archiving off")
  field(ONAM, "Archiving on")
  field(ZSV, "MINOR")
}

# Return He2 gas path switching Compressor/Gas Bag

record (bo, "CstatV-RHtr:opMode:cmdSetVBtoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=2")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetVBtoBaloon")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}
record (bo, "CstatV-RHtr:opMode:cmdRstVBtoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=3")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetVBtoCompr")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}

record (bo, "CstatV-RHtr:opMode:cmdSetCStoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=4")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetCStoBaloon")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}
record (bo, "CstatV-RHtr:opMode:cmdRstCStoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=5")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetCStoCompr")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}

record (bo, "CstatV-RHtr:opMode:cmdSetM4KtoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=6")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetM4KtoBaloon")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}
record (bo, "CstatV-RHtr:opMode:cmdRstM4KtoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=7")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetM4KtoCompr")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}
