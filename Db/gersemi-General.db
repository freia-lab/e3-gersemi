
record (bi, "CstatV-Ctrl:s7-status") {
  field (DTYP, "S7plc stat")
  field (INP,  "@PLC:GERSEMI")
  field (SCAN, "I/O Intr")
  field (ZNAM, "disconnected")
  field (ONAM, "connected")
  field (ZSV,  "MAJOR")
  field (FLNK, "CstatV-Ctrl:s7-status-counter")
}

record (bo, "CstatV-Ctrl:opMode:cmdLocal") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/1 T=BYTE B=0")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdLocal")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field(UDFS, "NO_ALARM")
}

record (bo, "CstatV-Ctrl:opMode:cmdRemote") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/1 T=BYTE B=1")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdRemote")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field(UDFS, "NO_ALARM")
}

record (bi, "CstatV-Ctrl:opMode:sLocal") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/0 T=BYTE B=0")
  field (PINI, "YES")
  field (PHAS, "0")
  field (ONAM,  "Local")
  field (ZNAM,  "Remote")
  field (SCAN, "I/O Intr")
}

###############################################
# Operation of dewar valve from Gersemi
#
record (bi, "CstatV-Ctrl:CV5203:sOpenReq") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/0 T=BYTE B=1")
  field (PINI, "YES")
  field (PHAS, "0")
  field (ONAM,  "Keep open request")
  field (ZNAM,  "Keep closed request")
  field (SCAN, "I/O Intr")
}

# End of CV5203 related records
#################################################################

record (longin, "CstatV-Ctrl:HeartBeat:sHBcounter") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/2 T=INT16")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}

record(mbbi, "CstatV-RHtr:VBox:opMode") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:GERSEMI/4 T=INT16")
  field(NOBT, "16")
  field(ZRVL, "0")
  field(ZRST, "Nothing")
  field(ZRSV, "MAJOR")
  field(ONVL, "2")
  field(ONST, "Closing CV580")
  field(TWVL, "4")
  field(TWST, "Closing FV580")
  field(THVL, "6")
  field(THST, "Opening FV586")
  field(FRVL, "8")
  field(FRST, "Opening CV580")
  field(FVVL, "10")
  field(FVST, "To gas bag")
  field(SXVL, "12")
  field(SXST, "Closing CV580")
  field(SVVL, "14")
  field(SVST, "Closing FV586")
  field(EIVL, "16")
  field(EIST, "Opening FV580")
  field(NIVL, "18")
  field(NIST, "Opening CV580")
  field(TEVL, "20")
  field(TEST, "To Kaeser")
  field(SCAN, "I/O Intr")
}

record(mbbi, "CstatV-RHtr:Cstat4K:opMode") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:GERSEMI/6 T=INT16")
  field(NOBT, "16")
  field(ZRVL, "0")
  field(ZRST, "Nothing")
  field(ZRSV, "MAJOR")
  field(ONVL, "2")
  field(ONST, "Closing CV581")
  field(TWVL, "4")
  field(TWST, "Closing FV581")
  field(THVL, "6")
  field(THST, "Opening FV584")
  field(FRVL, "8")
  field(FRST, "Opening CV581")
  field(FVVL, "10")
  field(FVST, "To gas bag")
  field(SXVL, "12")
  field(SXST, "Closing CV581")
  field(SVVL, "14")
  field(SVST, "Closing FV584")
  field(EIVL, "16")
  field(EIST, "Opening FV581")
  field(NIVL, "18")
  field(NIST, "Opening CV581")
  field(TEVL, "20")
  field(TEST, "To Kaeser")
  field(SCAN, "I/O Intr")
}

record(mbbi, "CstatV-RHtr:Mag4K:opMode") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:GERSEMI/8 T=INT16")
  field(NOBT, "16")
  field(ZRVL, "0")
  field(ZRST, "Liquid or Vacuum Insert")
  field(ONVL, "2")
  field(ONST, "Closing CV583")
  field(TWVL, "4")
  field(TWST, "Closing FV583")
  field(THVL, "6")
  field(THST, "Opening FV585")
  field(FRVL, "8")
  field(FRST, "Opening CV583")
  field(FVVL, "10")
  field(FVST, "To gas bag")
  field(SXVL, "12")
  field(SXST, "Closing CV583")
  field(SVVL, "14")
  field(SVST, "Closing FV585")
  field(EIVL, "16")
  field(EIST, "Opening FV583")
  field(NIVL, "18")
  field(NIST, "Opening CV583")
  field(TEVL, "20")
  field(TEST, "To Kaeser")
  field(ELVL, "22")
  field(ELST, "Liquid or Vacuum Insert")
  field(SCAN, "I/O Intr")
}

record(mbbi, "CstatV-Ctrl:SQ13:sSubStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:GERSEMI/10 T=INT16")
  field(NOBT, "16")
  field(ZRVL, "0")
  field(ZRST, "Idle")
  field(ONVL, "1")
  field(ONST, "Waiting for PT660 to rise")
  field(TWVL, "2")
  field(TWST, "Waiting for CV581 to open")
  field(SCAN, "I/O Intr")
}

record(mbbi, "CstatV-Ctrl:SQ17:sSubStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:GERSEMI/12 T=INT16")
  field(NOBT, "16")
  field(ZRVL, "0")
  field(ZRST, "Idle")
  field(ONVL, "1")
  field(ONST, "Waiting for PT660 to rise")
  field(TWVL, "2")
  field(TWST, "Waiting for CV581 to open")
  field(SCAN, "I/O Intr")
}

record (longin, "CstatV-Ctrl:Alarms:sAlarmB1") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9438 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB2") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9439 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB3") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9440 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB4") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9441 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB5") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9442 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}

record (longin, "CstatV-Ctrl:Alarms:sAlarmB6") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9443 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB7") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9444 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB8") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9445 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB9") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9446 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}
record (longin, "CstatV-Ctrl:Alarms:sAlarmB10") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:GERSEMI/9447 T=UINT8")
  field (PINI, "YES")
  field (SCAN, "I/O Intr")
}


record (bo, "CstatV-Ctrl:opMode:cmdSetParam") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=0")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetParam")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (UDFS, "NO_ALARM")
}

record (bo, "CstatV-Ctrl:opMode:cmdSetAck") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=1")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetAck")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (UDFS, "NO_ALARM")
}


#record (bo, "CstatV-Ctrl:opMode:cmdRemote") {
#  field (DTYP, "S7plc")
#  field (OUT, "@PLC:GERSEMI/1 T=BYTE B=1")
#  field (ZNAM, "Iddle")
#  field (ONAM, "CmdRemote")
#  field (PINI, "NO")
#  field (HIGH, "0.5")
#  field (UDFS, "NO_ALARM")
#}

record (calc, "CstatV-Ctrl:s7-status-counter")
{
   field (INPA, "CstatV-Ctrl:s7-status-counter")
   field (CALC, "A+1")
   field (FLNK, "CstatV-Ctrl:s7-disconnect-counter")
}

record (calc, "CstatV-Ctrl:s7-disconnect-counter")
{
   field (INPA, "CstatV-Ctrl:s7-status")
   field (INPB, "CstatV-Ctrl:s7-disconnect-counter.LA")
   field (INPC, "CstatV-Ctrl:s7-disconnect-counter")
   field (CALC, "(A=0&&B=1)?C+1:C")
}

# Commands specific for given sequences

record(bo, "CstatV-Ctrl:SQ9:cmdStopLiq") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:GERSEMI/4549 T=BYTE B=1")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ZNAM, "Iddle")
  field(ONAM, "CmdStopLiq")
  field(SDIS, "CstatV-Ctrl:opMode:sLocal")
}

record(bo, "CstatV-Ctrl:SQ9:cmdStopDwr") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:GERSEMI/4549 T=BYTE B=2")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ZNAM, "Iddle")
  field(ONAM, "CmdStopLiq")
  field(SDIS, "CstatV-Ctrl:opMode:sLocal")
}

record(bo, "CstatV-Ctrl:Archiving:On") {
  field(DESC, "Turn CstatV archiving on or off")
  field(ZNAM, "Archiving off")
  field(ONAM, "Archiving on")
  field(ZSV, "MINOR")
  field(PINI, "YES")
}

# Return He2 gas path switching Compressor/Gas Bag

record (bo, "CstatV-RHtr:opMode:cmdSetVBtoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=2")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetVBtoBaloon")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (UDFS, "NO_ALARM")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}
record (bo, "CstatV-RHtr:opMode:cmdRstVBtoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=3")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetVBtoCompr")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (UDFS, "NO_ALARM")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}

record (bo, "CstatV-RHtr:opMode:cmdSetCStoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=4")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetCStoBaloon")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (UDFS, "NO_ALARM")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}
record (bo, "CstatV-RHtr:opMode:cmdRstCStoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=5")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetCStoCompr")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (UDFS, "NO_ALARM")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}

record (bo, "CstatV-RHtr:opMode:cmdSetM4KtoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=6")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetM4KtoBaloon")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (UDFS, "NO_ALARM")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}
record (bo, "CstatV-RHtr:opMode:cmdRstM4KtoBaloon") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:GERSEMI/0 T=BYTE B=7")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdSetM4KtoCompr")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field (UDFS, "NO_ALARM")
  field (SDIS, "CstatV-Ctrl:opMode:sLocal")
}

# SQ15 related data
# Magnets dT/dL (TT665M-TT662M)/SQ15:sP_DeltaL

record (calcout, "CstatV-Ctrl:SQ15:dT/dL-HIGH") {
  field (SCAN, "10 second")
  field (INPA, "CstatV-Ctrl:SQ15:sP_dT_o_dL_max")
  field (CALC, "A")
  field (OUT, "CstatV-Ctrl:SQ15:dT/dL.HIGH PP")
  field (FLNK, "CstatV-Ctrl:SQ15:dT/dL-LOW")
}
record (calcout, "CstatV-Ctrl:SQ15:dT/dL-LOW") {
  field (INPA, "CstatV-Ctrl:SQ15:sP_dT_o_dL_max")
  field (CALC, "-A")
  field (OUT, "CstatV-Ctrl:SQ15:dT/dL.LOW PP")
}

record (calc, "CstatV-Ctrl:SQ15:dT/dL") {
  field (INPA, "CstatV-LHe:TT665M:sRdV")
  field (INPB, "CstatV-LHe:TT662M:sRdV")
  field (INPC, "CstatV-Ctrl:SQ15:sP_DeltaL")
  field (CALC, "(A-B)/C")
  field (PREC, "1")
  field (HSV, "MAJOR")
  field (LSV, "MAJOR")
  field (EGU, "K/m")
}

record (calcout, "CstatV-Ctrl:SQ15:dT/dt-HIGH") {
  field (SCAN, "10 second")
  field (INPA, "CstatV-Ctrl:SQ15:sP_dT_o_dt_max")
  field (CALC, "A")
  field (OUT, "CstatV-Ctrl:SQ15:dT/dt.HIGH")
  field (FLNK, "CstatV-Ctrl:SQ15:dT/dt-LOW")
}

record (calcout, "CstatV-Ctrl:SQ15:dT/dt-LOW") {
  field (INPA, "CstatV-Ctrl:SQ15:sP_dT_o_dt_max")
  field (CALC, "-A")
  field (OUT, "CstatV-Ctrl:SQ15:dT/dt.LOW PP")
}

record (calc, "CstatV-Ctrl:SQ15:dT/dt") {
  field (INPA, "CstatV-LHe:TT662M:sRdV")
  field (INPB, "CstatV-Ctrl:SQ15:dT/dt.LA")
  field (INPC, "CstatV-Ctrl:SQ15:dT/dt")
  field (INPD, "CstatV-Ctrl:SQ15:dT/dt.LC")
  field (INPE, "0.9")
  field (CALC, "6*(A-B)*(1-E)+E*C")
  field (PREC, "1")
  field (HSV, "MAJOR")
  field (LSV, "MAJOR")
  field (EGU, "K/min")
}

#####################################################################
#
# PVs for the sequencer program for automatic 2K pumps start-up
#
#####################################################################

record (bo, "$(P)-Ctrl:SQ13:c2KpumpsAuto") {
  field(DESC, "2K Pumps automatic start-up")
  field(ZNAM, "Manual")
  field(ONAM, "Automatic")
  field(VAL, "0")
  field(PINI, "YES")
}

record (ao, "$(P)-Ctrl:SQ13:cP_2KpumpsStep") {
  field(DESC, "2K Pumps step at start-up")
  field(VAL, 10)
  field(PINI, "YES")
  field(EGU, "%")
}

record (ao, "$(P)-Ctrl:SQ13:cP_FT551forStartUp") {
  field(DESC, "Flow limit at start-up")
  field(VAL, 60)
  field(PINI, "YES")
  field(EGU, "m³/h")
}

record (ao, "$(P)-Ctrl:SQ13:cP_WHfinal") {
  field(DESC, "WH Pumps final value at start-up")
  field(VAL, 50)
  field(PINI, "YES")
  field(EGU, "%")
}

record (bo, "$(P)-Ctrl:SQ17:c2KpumpsAuto") {
  field(DESC, "2K Pumps automatic start-up")
  field(ZNAM, "Manual")
  field(ONAM, "Automatic")
  field(VAL, "0")
  field(PINI, "YES")
}

record (ao, "$(P)-Ctrl:SQ17:cP_2KpumpsStep") {
  field(DESC, "2K Pumps step at start-up")
  field(VAL, 10)
  field(PINI, "YES")
  field(EGU, "%")
}

record (ao, "$(P)-Ctrl:SQ17:cP_FT551forStartUp") {
  field(DESC, "Flow limit at start-up")
  field(VAL, 60)
  field(PINI, "YES")
  field(EGU, "m³/h")
}

record (ao, "$(P)-Ctrl:SQ17:cP_WHfinal") {
  field(DESC, "WH Pumps final value at start-up")
  field(VAL, 50)
  field(PINI, "YES")
  field(EGU, "%")
}

record (bo, "$(P)-Ctrl:SQ13/17:c2KpumpsHold") {
  field(DESC, "Hold 2K Pumps warm-up")
  field(ZNAM, "Auto")
  field(ONAM, "Hold")
  field(VAL, "0")
  field(PINI, "YES")
}

record (stringin, "$(P)-Ctrl:SQ13/17:sStep2KstartUpStr") {
  field(DESC, "2K Pumps start-up state")
}

record (longout, "$(P)-Ctrl:SQ13/17:cStep2KstartUp") {
  field(DESC, "2K pumps start-up step")
}

record (calc, "$(P)-Ctrl:SQ13/17:2KSeq-timer") {
  field(SCAN, "1 second")
  field(EGU, "s")
  field(INPA, "$(P)-Ctrl:SQ13/17:2KSeq-timer")
  field(INPB, "$(P)-Ctrl:SQ13/17:cStep2KstartUp")
  field(INPC, "$(P)-Ctrl:SQ13/17:2KSeq-timer.LB")
  field(CALC, "(B#C)||(B==0)?0:A+1")
  field(VAL, "0")
  field(PINI, "YES")
  field(HIGH, "2700")
  field(HIHI, "3600")
  field(HSV, "MINOR")
  field(HHSV, "MAJOR")
}

#####################################################################
#
# PVs for the sequencer program for special mode of operation for FV601
#
#####################################################################

record (bo, "$(P)-Ctrl:SQ9:cFV601-SpecMode") {
  field(DESC, "Special operation of FV601")
  field(ZNAM, "Normal Operation")
  field(ONAM, "FV601 open when filling")
  field(VAL, "0")
  field(PINI, "YES")
}

record (stringin, "$(P)-Ctrl:SQ9:cFV601-SpecModState") {
  field(DESC, "FV601-SpecMode state")
}

